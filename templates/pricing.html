<!DOCTYPE html>
<html lang="en">

<!-- Basic -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Mobile Metas -->
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

<!-- Site Metas -->
<title>Vitalcheck - Algoritmos</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="">

<!-- Site Icons -->
<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="images/apple-touch-icon.png">

<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/versions.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/animate.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/flaticon.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/prettyPhoto.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/owl.carousel.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/slit-custom.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tippy.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/font-awesome.min.css') }}">

<style>
    select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        font-weight: bold;
        color: #333;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        appearance: none;
        /* Elimina el estilo por defecto del navegador */
        -webkit-appearance: none;
        /* Para navegadores basados en WebKit */
        -moz-appearance: none;
        /* Para Firefox */
    }

    /* Estilo al pasar el cursor sobre el select */
    select:hover {
        background-color: #f1f1f1;
        border-color: #007bff;
    }

    /* Estilo al hacer clic o al tener el focus */
    select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 3px rgba(0, 123, 255, 0.5);
    }

    /* Agregar un icono personalizado para el desplegable */
    select::-ms-expand {
        display: none;
        /* Ocultar el icono predeterminado en IE/Edge */
    }
</style>


<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body class="seo_version">

    <!-- LOADER -->
    <div id="preloader">
        <div class="loader-wrapper">
            <div class="loader-new">
                <div class="ball"></div>
                <div class="ball"></div>
                <div class="ball"></div>
            </div>
            <div class="text">LOADING...</div>
        </div>
    </div>
    <!-- END LOADER -->

    <!-- Start header -->
    <!-- Start header -->
    <header class="top-navbar">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container">
                <a class="navbar-brand" href="{{ url_for('home') }}">
                    <img src="{{ url_for('static', filename='images/vitalcheck-logo.png') }}" alt="Vitalcheck Logo"
                        style="max-height: 50px;" />
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbars-seo"
                    aria-controls="navbars-rs-food" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbars-seo">
                    <ul class="navbar-nav ml-auto">
                        <!-- Enlace actualizado para Home -->
                        <li class="nav-item"><a class="nav-link" href="{{ url_for('home') }}">Home</a></li>
                        <!-- Enlace actualizado para Algoritmos -->
                        <li class="nav-item active"><a class="nav-link" href="{{ url_for('index') }}">Algoritmos</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>



    <style>
        /* Estilos para el modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
    </style>

    <div id="predictionModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2>Ingrese los Datos para la Predicción</h2>
            <form id="predictionForm">
                <div class="form-group">
                    <label for="genetic_markers">Marcadores Geneticos</label>
                    <select name="genetic_markers" id="genetic_markers">
                        <option value="Positive" selected>Positivo</option>
                        <option value="Negative">Negativo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="autoantibodies">Anticuerpos</label>
                    <select name="autoantibodies" id="autoantibodies">
                        <option value="Positive" selected>Positivo</option>
                        <option value="Negative">Negativo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="family_history">Historial Familiar</label>
                    <select name="family_history" id="family_history">
                        <option value="Yes" selected>Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="environmental_factors">Factores Ambientales</label>
                    <select name="environmental_factors" id="environmental_factors">
                        <option value="Present" selected>Presente</option>
                        <option value="Absent">Absente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="insulin_levels">Niveles de insulina</label>
                    <input type="number" id="insulin_levels" name="insulin_levels" value="27">
                </div>
                <div class="form-group">
                    <label for="age">Edad</label>
                    <input type="number" id="age" name="age" value="36">
                </div>
                <div class="form-group">
                    <label for="bmi">Indice de masa corporal</label>
                    <input type="number" id="bmi" name="bmi" value="24">
                </div>
                <div class="form-group">
                    <label for="physical_activity">Actividad Fisica</label>
                    <select name="physical_activity" id="physical_activity">
                        <option value="High" selected>Alto</option>
                        <option value="Moderate">Moderado</option>
                        <option value="Low">Bajo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="dietary_habits">Habitos de dieta</label>
                    <select name="dietary_habits" id="dietary_habits">
                        <option value="Healthy" selected>Saludable</option>
                        <option value="Unhealthy">Poco saludable</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="blood_pressure">Presion de sangre</label>
                    <input type="number" id="blood_pressure" name="blood_pressure" value="121">
                </div>
                <div class="form-group">
                    <label for="cholesterol_levels">Niveles de colesterol</label>
                    <input type="number" id="cholesterol_levels" name="cholesterol_levels" value="185">
                </div>
                <div class="form-group">
                    <label for="waist_circumference">Circunferencia de la cintura</label>
                    <input type="number" id="waist_circumference" name="waist_circumference" value="36">
                </div>
                <div class="form-group">
                    <label for="blood_glucose_levels">Niveles de glucosa en sangre</label>
                    <input type="number" id="blood_glucose_levels" name="blood_glucose_levels" value="105">
                </div>
                <div class="form-group">
                    <label for="ethnicity">Etnicidad</label>
                    <select name="ethnicity" id="ethnicity">
                        <option value="High Risk" selected>Alto riesgo</option>
                        <option value="Low Risk">Bajo riesgo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="socioeconomic_factors">Factores socioeconomicos</label>
                    <select name="socioeconomic_factors" id="socioeconomic_factors">
                        <option value="High" selected>Alto</option>
                        <option value="Medium">Medio</option>
                        <option value="Low">Bajo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="smoking_status">Consumo de tabaco</label>
                    <select name="smoking_status" id="smoking_status">
                        <option value="Smoker" selected>Fumador</option>
                        <option value="Non-Smoker">No fumador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="alcohol_consumption">Consumo de alcohol</label>
                    <select name="alcohol_consumption" id="alcohol_consumption">
                        <option value="High" selected>Alto</option>
                        <option value="Modarate">Moderado</option>
                        <option value="Low">Bajo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="glucose_tolerance_test">Examen de tolerancia a la glucosa</label>
                    <select name="glucose_tolerance_test" id="glucose_tolerance_test">
                        <option value="Normal" selected>Normal</option>
                        <option value="Abnormal">Anormal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="history_of_pcos">Historial de síndrome de ovario poliquístico.</label>
                    <select name="history_of_pcos" id="history_of_pcos">
                        <option value="Yes" selected>Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="previous_gestational_diabetes">Diabetes gestacional previa</label>
                    <select name="previous_gestational_diabetes" id="previous_gestational_diabetes">
                        <option value="Yes" selected>Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pregnancy_history">Historial de embarazo</label>
                    <select name="pregnancy_history" id="pregnancy_history">
                        <option value="Normal" selected>Normal</option>
                        <option value="Complications">Complicaciones</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="weight_gain_during_pregnancy">Peso ganado durante el embarazo</label>
                    <input type="number" id="weight_gain_during_pregnancy" name="weight_gain_during_pregnancy"
                        value="15">
                </div>
                <div class="form-group">
                    <label for="pancreatic_health">Salud pancreática</label>
                    <input type="number" id="pancreatic_health" name="pancreatic_health" value="56">
                </div>
                <div class="form-group">
                    <label for="pulmonary_function">Función pulmonar</label>
                    <input type="number" id="pulmonary_function" name="pulmonary_function" value="80">
                </div>
                <div class="form-group">
                    <label for="cystic_fibrosis_diagnosis">Diagnóstico de fibrosis quística</label>
                    <select name="cystic_fibrosis_diagnosis" id="cystic_fibrosis_diagnosis">
                        <option value="Yes" selected>Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="steroid_use_history">Historial de uso de asteroides</label>
                    <select name="steroid_use_history" id="steroid_use_history">
                        <option value="Yes" selected>Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="genetic_testing">Pruebas genéticas</label>
                    <select name="genetic_testing" id="genetic_testing">
                        <option value="Positive" selected>Positivo</option>
                        <option value="Negative">Negativo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="neurological_assessments">Evaluaciones neurológicas</label>
                    <input type="number" id="neurological_assessments" name="neurological_assessments" value="1">
                </div>
                <div class="form-group">
                    <label for="liver_function_tests">Pruebas de función hepática</label>
                    <select name="liver_function_tests" id="liver_function_tests">
                        <option value="Normal" selected>Normal</option>
                        <option value="Abnormal">Anormal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="digestive_enzyme_levels">Niveles de enzimas digestivas</label>
                    <input type="number" id="digestive_enzyme_levels" name="digestive_enzyme_levels" value="55">
                </div>
                <div class="form-group">
                    <label for="urine_test">Prueba de orina</label>
                    <select name="urine_test" id="urine_test">
                        <option value="Ketones Present" selected>Ketones Presentes</option>
                        <option value="Glucose Present">Glucosa Presente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="birth_weight">Birth Weight</label>
                    <input type="number" id="birth_weight" name="birth_weight" value="3622">
                </div>
                <div class="form-group">
                    <label for="early_onset_symptoms">Síntomas de aparición temprana</label>
                    <select name="early_onset_symptoms" id="early_onset_symptoms">
                        <option value="Yes" selected>Si</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="button" onclick="submitPredictionForm()">Enviar Predicción</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Modal para mostrar el resultado de la predicción -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeResultModal()">&times;</span>
            <h2>Resultado de la Predicción</h2>
            <p id="predictionResult"></p>
        </div>
    </div>

    <style>
        /* Estilos para el modal de resultado */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 50%;
            text-align: center;
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>




    <div class="all-page-title"
        style="background-image:url({{ url_for('static', filename='images/pattern-4.png') }}); position: relative;">
        <div
            style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1;">
        </div>
        <div class="container text-center" style="position: relative; z-index: 2;">
            <h1 style="color: white;">Subir Archivo CSV</h1>
            <p style="color: white;">Sube un archivo CSV para procesar los datos y analizar la información de manera
                eficiente.</p>
            <form id="csv-form" action="#" method="POST" enctype="multipart/form-data" style="margin-top: 20px;">
                <div class="form-group">
                    <label for="file-upload" class="custom-file-upload">Seleccionar Archivo</label>
                    <input id="file-upload" type="file" name="csv_file" accept=".csv" required>
                </div>
            </form>
        </div>
    </div>

    <style>
        /* Estilo del botón de selección de archivo */
        .custom-file-upload {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .custom-file-upload:hover {
            background-color: #0056b3;
        }

        /* Ocultar el botón original */
        input[type="file"] {
            display: none;
        }
    </style>


    <div id="pricing" class="section wb">
        <div class="container">
            <div class="section-title text-center">
                <h3>Algoritmos</h3>
                <p class="lead">Selecciona uno de los tres algoritmos disponibles para procesar tus datos</p>
            </div><!-- end title -->

            <div class="row">
                <div class="col-md-12">
                    <div class="pricing pricing-palden">
                        <div class="pricing-item">
                            <div class="pricing-deco">
                                <div class="pricing-price">
                                    <h3 class="pricing-title" style="font-size: 1.5rem;">Árbol de Decisiones</h3>
                                </div>
                            </div>
                            <ul class="pricing-feature-list">
                                <li class="pricing-feature">Este algoritmo crea árboles de decisión para clasificar
                                    datos. Es útil para analizar información médica y hacer predicciones, como
                                    identificar riesgos de diabetes basados en niveles de glucosa o historial familiar.
                                </li>
                            </ul>
                            <button class="bttn-new-a" onclick="chooseAlgorithm('j48')">Elegir</button>
                        </div>
                        <div class="pricing-item pricing__item--featured">
                            <div class="pricing-deco">
                                <div class="pricing-price">
                                    <h3 class="pricing-title" style="font-size: 1.5rem;">Clustering</h3>
                                </div>
                            </div>
                            <ul class="pricing-feature-list">
                                <li class="pricing-feature">El Clustering agrupa datos similares en categorías. Esto
                                    ayuda a encontrar patrones entre pacientes, como factores de riesgo comunes o
                                    perfiles de estilo de vida relacionados con la diabetes.</li>
                            </ul>
                            <button class="bttn-new-a" onclick="chooseAlgorithm('kmeans')">Elegir</button>
                        </div>
                        <div class="pricing-item">
                            <div class="pricing-deco">
                                <div class="pricing-price">
                                    <h3 class="pricing-title" style="font-size: 1.5rem;">Red Neuronal</h3>
                                </div>
                            </div>
                            <ul class="pricing-feature-list">
                                <li class="pricing-feature">Las redes neuronales imitan el funcionamiento del cerebro
                                    para analizar datos complejos. Se utilizan para predecir riesgos de diabetes
                                    considerando múltiples factores, como hábitos y genética.</li>
                            </ul>
                            <button class="bttn-new-a" onclick="chooseAlgorithm('mlp')">Elegir</button>
                        </div>
                    </div>
                </div><!-- end col -->
            </div><!-- end row -->
        </div><!-- end container -->
    </div><!-- end section -->

    <div class="btn-submit-container" style="text-align: center; padding-top: 30px; padding-bottom: 20px;">
        <button type="submit" class="bttn-new-a" onclick="submitForm()">Generar resultados</button>
    </div>


    <div id="result" style="margin-top: 20px; display: none;">
        <!-- Aquí se mostrarán los resultados -->
    </div>

    <div id="support" class="section db">
        <div class="container">
            <div class="row">
                <div id="logo-carousel" class="owl-carousel">
                </div>
            </div><!-- end row -->
        </div><!-- end container -->
    </div><!-- end section -->

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-6 col-xs-12">
                    <div class="widget clearfix">
                        <div class="widget-title">
                            <img src="{{ url_for('static', filename='images/vitalcheck-logo.png') }}"
                                alt="Vitalcheck Logo" style="max-height: 50px;" />
                        </div>
                        <p> Sistema de información orientado al manejo de datos para la identificación temprana y
                            seguimiento de condiciones prediabéticas y diabéticas</p>
                        <p>Si tienes alguna duda o problema no dudes en contactarnos, nuestros correos electrónicos se
                            encuentran a continuación</p>
                    </div><!-- end clearfix -->
                </div><!-- end col -->

                <div class="col-lg-2 col-md-6 col-xs-12">
                    <div class="widget clearfix">
                        <div class="widget-title">
                            <h3>Información</h3>
                        </div>
                        <ul class="footer-links">
                            <li><a href="#">Home</a></li>
                            <li><a href="#">Algoritmos</a></li>
                        </ul><!-- end links -->
                    </div><!-- end clearfix -->
                </div><!-- end col -->

                <div class="col-lg-3 col-md-6 col-xs-12">
                    <div class="widget clearfix">

                        <div class="widget-title">
                            <h3>Redes Sociales</h3>
                        </div>
                        <ul class="footer-links social-md">
                            <li><a class="fb btn-a" title="Facebook" data-tippy-animation="scale" href="#"><i
                                        class="fa fa-facebook"></i></a></li>
                            <li><a class="gi btn-a" title="Github" data-tippy-animation="scale" href="#"><i
                                        class="fa fa-github"></i> </a></li>
                            <li><a class="tw btn-a" title="Twitter" data-tippy-animation="scale" href="#"><i
                                        class="fa fa-twitter"></i> </a></li>
                            <li><a class="dr btn-a" title="Dribbble" data-tippy-animation="scale" href="#"><i
                                        class="fa fa-dribbble"></i> </a></li>
                            <li><a class="pi btn-a" title="Pinterest" data-tippy-animation="scale" href="#"><i
                                        class="fa fa-pinterest"></i> </a></li>
                        </ul><!-- end links -->
                    </div><!-- end clearfix -->
                </div><!-- end col -->

                <div class="col-lg-3 col-md-6 col-xs-12">
                    <div class="widget clearfix">
                        <div class="widget-title">
                            <h3>Detalles de Contacto</h3>
                        </div>

                        <ul class="footer-links">
                            <li><a href="mailto:#">dominicescalante@gmail.com</a></li>
                            <li><a href="#">fmattosteran@gmail.com</a></li>
                            <li>jared170209@gmail.com</li>
                            <li>mateovalenxd@gmail.com</li>
                        </ul><!-- end links -->
                    </div><!-- end clearfix -->
                </div><!-- end col -->

            </div><!-- end row -->
        </div><!-- end container -->
    </footer><!-- end footer -->

    <div class="copyrights">
        <div class="container">
            <div class="footer-distributed">
                <div class="footer-left">
                </div>
            </div>
        </div><!-- end container -->
    </div><!-- end copyrights -->

    <a href="#" id="scroll-to-top" class="dmtop global-radius"><i class="fa fa-angle-up"></i></a>

    <!-- ALL JS FILES -->
    <script src="{{ url_for('static', filename='js/all.js') }}"></script>
    <script src="{{ url_for('static', filename='js/custom.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tippy.all.min.js') }}"></script>
    <script>
        let selectedAlgorithm = null;

        function chooseAlgorithm(algorithm) {
            selectedAlgorithm = algorithm;
        }

        function submitForm() {
            if (!selectedAlgorithm) {
                alert("Por favor, selecciona un algoritmo primero.");
                return;
            }

            let numClusters = null;

            // Si el algoritmo seleccionado es KMeans, pedir número de clusters
            if (selectedAlgorithm === "kmeans") {
                numClusters = prompt("Por favor, ingrese el número de clusters (k):");
                if (!numClusters || isNaN(numClusters) || numClusters <= 0) {
                    alert("Debes ingresar un número válido de clusters.");
                    return;
                }
            }

            const form = document.getElementById("csv-form");
            const formData = new FormData(form);

            formData.append("algorithm", selectedAlgorithm);
            if (numClusters) formData.append("num_clusters", numClusters); // Agregar número de clusters si aplica

            fetch(`/run_${selectedAlgorithm}`, {
                method: "POST",
                body: formData,
            })
                .then((response) => response.json())
                .then((data) => {
                    let contentHTML = ""; // Resetear contenido

                    // Manejar errores devueltos por el servidor
                    if (data.status === "error") {
                        contentHTML = `
                        <div style="text-align: center; margin-top: 20px; color: red;">
                            Error: ${data.message}
                        </div>`;
                        document.getElementById("result").innerHTML = contentHTML;
                        document.getElementById("result").style.display = "block";
                        return;
                    }
                    if (selectedAlgorithm === "j48" && data.feature_importance) {
    // Tabla para importancia de los predictores generales
    contentHTML += `
    <div style="text-align: center; margin-top: 20px;">
        <h3>Importancia de los Predictores (General):</h3>
        <table border="1" style="width: 70%; margin: 0 auto; text-align: left; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 10px;">Predictor</th>
                    <th style="padding: 10px;">Importancia</th>
                </tr>
            </thead>
            <tbody>`;
    
    data.feature_importance.forEach((feature) => {
        contentHTML += `
        <tr>
            <td style="padding: 10px;">${feature.predictor}</td>
            <td style="padding: 10px;">${parseFloat(feature.importancia).toFixed(2)}</td>
        </tr>`;
    });

    contentHTML += `
            </tbody>
        </table>
    </div>`;

    // Agregar la imagen del árbol general
    if (data.tree_image_url) {
        contentHTML += `
        <div style="text-align: center; margin-top: 20px;">
            <h3>Árbol de Decisión (General):</h3>
            <img src="${data.tree_image_url}" 
                 alt="Visualización del Árbol J48 General" 
                 style="max-width: 70%; border: 1px solid #ddd; border-radius: 5px; padding: 10px;">
        </div>`;
    }

    // Si hay datos específicos para "Gestational Diabetes"
    if (data.feature_importance_gestational_diabetes && data.feature_importance_gestational_diabetes.length > 0) {
        // Tabla para importancia de los predictores específicos
        contentHTML += `
        <div style="text-align: center; margin-top: 20px;">
            <h3>Importancia de los Predictores (Gestational Diabetes):</h3>
            <table border="1" style="width: 70%; margin: 0 auto; text-align: left; border-collapse: collapse;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="padding: 10px;">Predictor</th>
                        <th style="padding: 10px;">Importancia</th>
                    </tr>
                </thead>
                <tbody>`;
        
        data.feature_importance_gestational_diabetes.forEach((feature) => {
            contentHTML += `
            <tr>
                <td style="padding: 10px;">${feature.predictor}</td>
                <td style="padding: 10px;">${parseFloat(feature.importancia).toFixed(2)}</td>
            </tr>`;
        });

        contentHTML += `
                </tbody>
            </table>
        </div>`;

        // Agregar la imagen del árbol para "Gestational Diabetes"
        if (data.tree_image_url_gestational_diabetes) {
            contentHTML += `
            <div style="text-align: center; margin-top: 20px;">
                <h3>Árbol de Decisión (Gestational Diabetes):</h3>
                <img src="${data.tree_image_url_gestational_diabetes}" 
                     alt="Visualización del Árbol J48 para Gestational Diabetes" 
                     style="max-width: 70%; border: 1px solid #ddd; border-radius: 5px; padding: 10px;">
            </div>`;
        }

    }
}

                    if (selectedAlgorithm === "mlp" && data.classification_report) {
                        // Tabla de precisión total y última iteración
                        contentHTML += `
    <div style="text-align: center; margin-top: 20px;">
        <h3>Resultados Generales:</h3>
        <table border="1" style="width: 50%; margin: 0 auto; text-align: left; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 10px;">Métrica</th>
                    <th style="padding: 10px;">Valor</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="padding: 10px;">Precisión Total</td>
                    <td style="padding: 10px;">${data.accuracy}%</td>
                </tr>
                <tr>
                    <td style="padding: 10px;">Última Iteración</td>
                    <td style="padding: 10px;">${data.last_iteration}</td>
                </tr>
            </tbody>
        </table>
    </div>`;

                        // Tabla de métricas de clasificación
                        contentHTML += `
    <div style="text-align: center; margin-top: 20px;">
        <h3>Reporte de Clasificación:</h3>
        <table border="1" style="width: 80%; margin: 0 auto; text-align: left; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 10px;">Clase</th>
                    <th style="padding: 10px;">Precisión</th>
                    <th style="padding: 10px;">Recall</th>
                    <th style="padding: 10px;">F1-Score</th>
                    <th style="padding: 10px;">Soporte</th>
                </tr>
            </thead>
            <tbody>`;

                        for (const [key, metrics] of Object.entries(data.classification_report)) {
                            if (typeof metrics === "object" && metrics.support !== undefined) {
                                contentHTML += `
            <tr>
                <td style="padding: 10px;">${key}</td>
                <td style="padding: 10px;">${parseFloat(metrics.precision).toFixed(2)}</td>
                <td style="padding: 10px;">${parseFloat(metrics.recall).toFixed(2)}</td>
                <td style="padding: 10px;">${parseFloat(metrics["f1-score"]).toFixed(2)}</td>
                <td style="padding: 10px;">${metrics.support}</td>
            </tr>`;
                            }
                        }

                        // Agregar macro avg y weighted avg
                        ["macro avg", "weighted avg"].forEach((avgType) => {
                            if (data.classification_report[avgType]) {
                                const metrics = data.classification_report[avgType];
                                contentHTML += `
            <tr style="font-weight: bold; background-color: #f9f9f9;">
                <td style="padding: 10px;">${avgType}</td>
                <td style="padding: 10px;">${parseFloat(metrics.precision).toFixed(2)}</td>
                <td style="padding: 10px;">${parseFloat(metrics.recall).toFixed(2)}</td>
                <td style="padding: 10px;">${parseFloat(metrics["f1-score"]).toFixed(2)}</td>
                <td style="padding: 10px;">${metrics.support}</td>
            </tr>`;
                            }
                        });

                        contentHTML += `</tbody></table></div>`;
                    }


                    // Crear tabla específica para KMeans
                    if (selectedAlgorithm === "kmeans" && data.cluster_centers) {
                        contentHTML += `
                        <div style="text-align: center; margin-top: 20px;">
                            <h3>Centroides de los Clusters:</h3>
                            <table border="1" style="width: 70%; margin: 0 auto; text-align: left; border-collapse: collapse;">
                                <thead>
                                    <tr style="background-color: #f2f2f2;">
                                        <th style="padding: 10px;">Atributo</th>`;
                        for (let cluster in data.cluster_centers) {
                            contentHTML += `<th style="padding: 10px;">${cluster}</th>`;
                        }
                        contentHTML += `</tr></thead><tbody>`;
                        const attributes = Object.keys(data.cluster_centers[Object.keys(data.cluster_centers)[0]]);
                        for (let attribute of attributes) {
                            contentHTML += `<tr><td style="padding: 10px;">${attribute}</td>`;
                            for (let cluster in data.cluster_centers) {
                                contentHTML += `<td style="padding: 10px;">${parseFloat(data.cluster_centers[cluster][attribute]).toFixed(2)}</td>`;
                            }
                            contentHTML += `</tr>`;
                        }
                        contentHTML += `</tbody></table></div>`;
                    }

                    // Crear imagen si está disponible
                    if (data.loss_curve_url || data.cluster_image_url) {
                        contentHTML += `
                <div style="text-align: center; margin-top: 20px;">
                    <img src="${data.loss_curve_url || data.cluster_image_url}" 
                    alt="Visualización" style="max-width: 70%; border: 1px solid #ddd; border-radius: 5px; padding: 10px;">
                </div>`;
                    }

                    //Boton de predicción
                    if (data.loss_curve_url || data.classification_report) {
                        contentHTML += `
    <div style="text-align: center; margin-top: 20px;">
        <button onclick="realizarPrediccion()" class="bttn-new-a">
            Realizar Predicción
        </button>
    </div>`;
                    }


                    // Mostrar resultados
                    document.getElementById("result").innerHTML = contentHTML;
                    document.getElementById("result").style.display = "block";
                })
                .catch((error) => {
                    document.getElementById("result").innerHTML = `
            <div style="text-align: center; margin-top: 20px; color: red;">
                Error en la conexión: ${error}
            </div>`;
                    document.getElementById("result").style.display = "block";
                });
        }

        // Función para mostrar el modal de predicción
        function realizarPrediccion() {
            const modal = document.getElementById("predictionModal");

            // Ocultar el botón de "Realizar Predicción"
            const realizarPrediccionButton = document.querySelector('button[onclick="realizarPrediccion()"]');
            if (realizarPrediccionButton) {
                realizarPrediccionButton.style.display = "none";
            }

            modal.style.display = "block";
        }

        // Función para cerrar el modal de predicción
        function closeModal() {
            const modal = document.getElementById("predictionModal");
            modal.style.display = "none";

            // No mostrar aún el botón, ya que el modal de resultados podría estar abierto
        }

        // Función para mostrar el modal del resultado
        function showResultModal() {
            const modal = document.getElementById("resultModal");
            modal.style.display = "block";
        }

        // Función para cerrar el modal del resultado
        function closeResultModal() {
            const modal = document.getElementById("resultModal");
            modal.style.display = "none";

            // Mostrar el botón de "Realizar Predicción" solo después de cerrar el modal de resultado
            const realizarPrediccionButton = document.querySelector('button[onclick="realizarPrediccion()"]');
            if (realizarPrediccionButton) {
                realizarPrediccionButton.style.display = "inline-block";
            }
        }

        // Función para enviar los datos del formulario de predicción
        function submitPredictionForm() {
            const form = document.getElementById("predictionForm");
            const formData = new FormData(form);

            // Convertir FormData a un objeto simple
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // Enviar datos a la API para realizar la predicción
            fetch('/predict_mlp', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    if (result.status === "success") {
                        // Mostrar el resultado en el modal
                        document.getElementById("predictionResult").textContent = `El modelo predice que el tipo de diabetes es: ${result.predicted_class}`;
                        showResultModal();
                    } else {
                        document.getElementById("predictionResult").textContent = `Error: ${result.message}`;
                        showResultModal();
                    }
                })
                .catch(error => {
                    console.error('Error al realizar la predicción:', error);
                    document.getElementById("predictionResult").textContent = 'Hubo un error al realizar la predicción.';
                    showResultModal();
                });

            // Cerrar el modal de predicción
            closeModal();
        }

        // Cerrar el modal al hacer clic fuera de él
        window.onclick = function (event) {
            const predictionModal = document.getElementById("predictionModal");
            const resultModal = document.getElementById("resultModal");

            if (event.target == predictionModal) {
                predictionModal.style.display = "none";
            }
            if (event.target == resultModal) {
                resultModal.style.display = "none";
                closeResultModal(); // Asegurar que el botón reaparezca cuando se cierre el modal de resultado
            }
        }



    </script>


</body>

</html>