from flask import Flask, jsonify, request,render_template
import weka.core.jvm as jvm
from weka.classifiers import Classifier, Evaluation
from weka.core.converters import Loader
from weka.core.classes import Random
import tempfile
import os

app = Flask(__name__)

jvm.start()

@app.route('/')
def index():
    return render_template('Algoritmos.html')


@app.route('/run_j48', methods=['POST'])
def run_j48():
    try:
        csv_path = "diabetes_dataset00.csv"  

        loader = Loader(classname="weka.core.converters.CSVLoader")
        data = loader.load_file(csv_path)

        data.class_is_last()

        classifier = Classifier(classname="weka.classifiers.trees.J48")
        classifier.build_classifier(data)

        evaluation = Evaluation(data)
        evaluation.crossvalidate_model(classifier, data, 10, Random(1))

        model = classifier.to_commandline() 

        summary = {
            "correctly_classified": evaluation.correct(),
            "incorrectly_classified": evaluation.incorrect(),
            "accuracy": evaluation.percent_correct,
            "kappa": evaluation.kappa,
            "mean_absolute_error": evaluation.mean_absolute_error,
            "root_mean_squared_error": evaluation.root_mean_squared_error,
            "confusion_matrix": evaluation.confusion_matrix,
            "class_details": evaluation.class_details(),
        }

        return jsonify({"status": "success", "model": model, "summary": summary})

    except Exception as e:
        return jsonify({"status": "error", "message": str(e)})

if __name__ == '__main__':
    app.run(debug=True)

import atexit
atexit.register(jvm.stop)